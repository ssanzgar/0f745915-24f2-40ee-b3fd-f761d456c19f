<!DOCTYPE html>
<html lang="es">
<head>
        <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Beyond Brain.fm - Sistema Cient√≠ficamente Honesto</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0a0a2e, #16213e, #1a1a3e);
            color: #ffffff;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            background: rgba(255,255,255,0.05);
            padding: 30px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
        }

        .title {
            font-size: 2.8em;
            background: linear-gradient(45deg, #667eea, #764ba2, #f093fb);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #b794f6;
            font-size: 1.1em;
            margin-bottom: 15px;
        }

        .evidence-badge {
            background: rgba(76, 175, 80, 0.2);
            color: #A5D6A7;
            padding: 6px 12px;
            border-radius: 12px;
            font-size: 0.85em;
            display: inline-block;
            margin: 5px;
            border: 1px solid rgba(76, 175, 80, 0.3);
        }

        .main-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 25px;
            margin-bottom: 25px;
        }

        @media (max-width: 968px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }

        .states-panel {
            background: rgba(255,255,255,0.08);
            padding: 25px;
            border-radius: 20px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .state-card {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 20px;
            margin: 15px 0;
            border: 2px solid transparent;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .state-card:hover {
            border-color: rgba(102, 126, 234, 0.5);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.2);
        }

        .state-card.selected {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.1);
        }

        .state-header {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .state-icon {
            font-size: 2em;
            margin-right: 15px;
        }

        .state-title {
            font-size: 1.3em;
            color: #e2e8f0;
        }

        .state-params {
            font-size: 0.9em;
            color: #a0aec0;
            margin-bottom: 8px;
        }

        .state-evidence {
            font-size: 0.85em;
            color: #68d391;
            margin-bottom: 5px;
        }

        .state-description {
            font-size: 0.9em;
            color: #cbd5e0;
            line-height: 1.4;
        }

        .control-panel {
            background: rgba(255,255,255,0.08);
            padding: 25px;
            border-radius: 20px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .current-state {
            text-align: center;
            margin-bottom: 25px;
        }

        .current-state-title {
            font-size: 1.1em;
            color: #b794f6;
            margin-bottom: 10px;
        }

        .current-state-name {
            font-size: 1.8em;
            color: #667eea;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .current-params {
            font-size: 0.9em;
            color: #a0aec0;
        }

        .duration-selector {
            margin: 20px 0;
        }

        .duration-options {
            display: flex;
            gap: 10px;
            margin: 10px 0;
            flex-wrap: wrap;
        }

        .duration-btn {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            color: #e2e8f0;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.9em;
        }

        .duration-btn:hover, .duration-btn.selected {
            background: #667eea;
            border-color: #667eea;
            color: white;
        }

        .visualizer {
            height: 60px;
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            margin: 20px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 2px;
            padding: 10px;
        }

        .wave-bar {
            width: 3px;
            background: linear-gradient(180deg, #667eea, #764ba2);
            border-radius: 2px;
            transition: height 0.3s ease;
        }

        .controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
            margin: 20px 0;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-primary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            transform: scale(1.05);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        .btn-warning {
            background: linear-gradient(45deg, #f093fb, #f5576c);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(45deg, #ff6b6b, #ee5a52);
            color: white;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: none !important;
        }

        .session-info {
            background: rgba(102, 126, 234, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            text-align: center;
        }

        .session-info.hidden {
            display: none;
        }

        .timer-display {
            font-family: 'Courier New', monospace;
            font-size: 1.4em;
            color: #667eea;
            margin: 10px 0;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255,255,255,0.1);
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transition: width 0.5s ease;
            width: 0%;
        }

        .evaluation-panel {
            grid-column: 1 / -1;
            background: rgba(255,255,255,0.08);
            padding: 25px;
            border-radius: 20px;
            border: 1px solid rgba(255,255,255,0.1);
            margin-top: 20px;
        }

        .eval-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .eval-section {
            background: rgba(255,255,255,0.05);
            padding: 20px;
            border-radius: 12px;
        }

        .rating-scale {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
            background: rgba(255,255,255,0.05);
            padding: 10px;
            border-radius: 8px;
        }

        .rating-btn {
            width: 35px;
            height: 35px;
            border: 2px solid rgba(255,255,255,0.2);
            background: transparent;
            color: #e2e8f0;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.9em;
            font-weight: bold;
        }

        .rating-btn:hover, .rating-btn.selected {
            border-color: #667eea;
            background: #667eea;
            color: white;
            transform: scale(1.1);
        }

        .scientific-info {
            grid-column: 1 / -1;
            background: rgba(76, 175, 80, 0.05);
            border: 1px solid rgba(76, 175, 80, 0.2);
            padding: 25px;
            border-radius: 20px;
            margin-top: 20px;
        }

        .research-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .research-card {
            background: rgba(255,255,255,0.03);
            padding: 20px;
            border-radius: 12px;
            border: 1px solid rgba(76, 175, 80, 0.2);
        }

        .alert {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 20px;
            border-radius: 12px;
            max-width: 400px;
            z-index: 1000;
            animation: slideIn 0.5s ease;
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }

        .alert-success {
            background: linear-gradient(45deg, #68d391, #48bb78);
            color: #000;
        }

        .alert-info {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: #fff;
        }

        .alert-warning {
            background: linear-gradient(45deg, #f093fb, #f5576c);
            color: #fff;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }

        .honest-disclaimer {
            background: rgba(255, 193, 7, 0.1);
            border: 2px solid #fbbf24;
            border-radius: 15px;
            padding: 25px;
            margin: 25px 0;
            text-align: center;
        }

        .params-display {
            background: rgba(0,0,0,0.2);
            padding: 10px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.85em;
            color: #a0aec0;
            margin: 10px 0;
        }
    </style>
    <!-- PWA Configuration -->
    <link rel="manifest" href="./manifest.json">
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Beyond Brain.fm">
    <link rel="apple-touch-icon" href="./icon-192x192.png">
    <link rel="icon" type="image/png" sizes="192x192" href="./icon-192x192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="./icon-512x512.png">
</head>
<body>
    <div class="container">
        <!-- HEADER -->
        <div class="header">
            <h1 class="title">üß† BEYOND BRAIN.FM</h1>
            <p class="subtitle">Sistema Cient√≠ficamente Honesto ‚Ä¢ Basado en Evidencia Real ‚Ä¢ Sin Marketing Exagerado</p>
            <div class="evidence-badge">üìö Literatura Revisada</div>
            <div class="evidence-badge">‚öñÔ∏è Claims Verificables</div>
            <div class="evidence-badge">üî¨ Transparencia Total</div>
            <div class="evidence-badge">üéØ Auto-Evaluaci√≥n</div>
        </div>

        <!-- HONEST DISCLAIMER -->
        <div class="honest-disclaimer">
            <h3 style="color: #fbbf24; margin-bottom: 15px;">‚ö†Ô∏è TRANSPARENCIA CIENT√çFICA TOTAL</h3>
            <p style="line-height: 1.6; color: #fef3c7;">
                <strong>Este sistema NO garantiza mejoras cognitivas.</strong> Los efectos de audio neurol√≥gico son:
                <strong>sutiles, variables entre personas, principalmente subjetivos</strong>. Basado en par√°metros de estudios reales,
                pero los resultados individuales <strong>NO est√°n garantizados</strong>. Usar para exploraci√≥n personal,
                no como tratamiento m√©dico.
            </p>
        </div>

        <!-- MAIN INTERFACE -->
        <div class="main-grid">
            <!-- ESTADOS DISPONIBLES -->
            <div class="states-panel">
                <h3 style="color: #b794f6; margin-bottom: 20px; font-size: 1.4em;">üéØ Estados Disponibles</h3>
                
                <div class="state-card" data-state="deep-relaxation" onclick="selectState('deep-relaxation')">
                    <div class="state-header">
                        <span class="state-icon">üßò</span>
                        <span class="state-title">Deep Relaxation</span>
                    </div>
                    <div class="state-evidence">üìö Evidencia: ALTA (40+ estudios)</div>
                    <div class="state-params">üéµ Alpha 10Hz ‚Ä¢ üîä 220Hz portadora ‚Ä¢ üìä 30% modulaci√≥n</div>
                    <div class="state-description">
                        Estado de relajaci√≥n profunda basado en investigaci√≥n Alpha s√≥lida. Efectos reportados:
                        reducci√≥n de cortisol, menor activaci√≥n simp√°tica, sensaci√≥n subjetiva de calma.
                    </div>
                    <div class="params-display">
                        Par√°metros: Isochronic 10Hz | Carrier 220Hz | Envelope 0.3 | Duration 15-25min
                    </div>
                </div>

                <div class="state-card" data-state="calm-focus" onclick="selectState('calm-focus')">
                    <div class="state-header">
                        <span class="state-icon">‚ö°</span>
                        <span class="state-title">Calm Focus</span>
                    </div>
                    <div class="state-evidence">üìö Evidencia: ALTA (neurofeedback cl√≠nico)</div>
                    <div class="state-params">üéµ SMR 13Hz ‚Ä¢ üîä 220Hz portadora ‚Ä¢ üìä 25% modulaci√≥n</div>
                    <div class="state-description">
                        Protocolo SMR usado en neurofeedback cl√≠nico. Efectos documentados: reducci√≥n de ansiedad,
                        mejora en tareas de atenci√≥n sostenida, regulaci√≥n emocional.
                    </div>
                    <div class="params-display">
                        Par√°metros: Isochronic 13Hz | Carrier 220Hz | Envelope 0.25 | Duration 20-30min
                    </div>
                </div>

                <div class="state-card" data-state="meditative" onclick="selectState('meditative')">
                    <div class="state-header">
                        <span class="state-icon">üåô</span>
                        <span class="state-title">Meditative State</span>
                    </div>
                    <div class="state-evidence">üìö Evidencia: MODERADA (estudios mixtos)</div>
                    <div class="state-params">üéµ Theta 6Hz ‚Ä¢ üîä 220Hz portadora ‚Ä¢ üìä 35% modulaci√≥n</div>
                    <div class="state-description">
                        Estado Theta asociado con meditaci√≥n profunda. Evidencia limitada pero consistente para
                        introspecci√≥n, relajaci√≥n profunda, posible acceso a estados meditativos.
                    </div>
                    <div class="params-display">
                        Par√°metros: Isochronic 6Hz | Carrier 220Hz | Envelope 0.35 | Duration 20-35min
                    </div>
                </div>
            </div>

            <!-- PANEL DE CONTROL -->
            <div class="control-panel">
                <div class="current-state">
                    <div class="current-state-title">Estado Actual</div>
                    <div class="current-state-name" id="currentStateName">Ninguno</div>
                    <div class="current-params" id="currentStateParams">Selecciona un estado</div>
                </div>

                <!-- SELECTOR DE DURACI√ìN -->
                <div class="duration-selector">
                    <h4 style="color: #b794f6; margin-bottom: 10px;">‚è∞ Duraci√≥n</h4>
                    <div class="duration-options">
                        <button class="duration-btn" data-duration="10" onclick="selectDuration(10)">10 min</button>
                        <button class="duration-btn selected" data-duration="15" onclick="selectDuration(15)">15 min</button>
                        <button class="duration-btn" data-duration="20" onclick="selectDuration(20)">20 min</button>
                        <button class="duration-btn" data-duration="25" onclick="selectDuration(25)">25 min</button>
                        <button class="duration-btn" data-duration="30" onclick="selectDuration(30)">30 min</button>
                    </div>
                </div>

                <!-- VISUALIZADOR -->
                <div class="visualizer" id="visualizer">
                    <!-- Will be populated by JavaScript -->
                </div>

                <!-- CONTROLES -->
                <div class="controls">
                    <button class="btn btn-primary" id="startBtn" onclick="startSession()" disabled>
                        ‚ñ∂Ô∏è Iniciar Sesi√≥n
                    </button>
                    <button class="btn btn-warning" id="pauseBtn" onclick="togglePause()" disabled>
                        ‚è∏Ô∏è Pausar
                    </button>
                    <button class="btn btn-danger" id="stopBtn" onclick="stopSession()" disabled>
                        ‚èπÔ∏è Detener
                    </button>
                </div>

                <!-- INFO DE SESI√ìN -->
                <div class="session-info hidden" id="sessionInfo">
                    <div class="timer-display" id="timerDisplay">00:00</div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    <div style="font-size: 0.9em; color: #a0aec0;">
                        <span id="phaseDisplay">Preparando...</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- PANEL DE AUTO-EVALUACI√ìN -->
        <div class="evaluation-panel">
            <h3 style="color: #b794f6; margin-bottom: 15px; font-size: 1.4em;">üìä Auto-Evaluaci√≥n Post-Sesi√≥n</h3>
            <p style="color: #cbd5e0; margin-bottom: 20px;">
                Eval√∫a honestamente tus efectos subjetivos. Esta data ayuda a optimizar par√°metros personales.
                <strong>No existen respuestas "correctas"</strong> - reporta tu experiencia real.
            </p>
            
            <div class="eval-grid" id="evaluationGrid" style="display: none;">
                <div class="eval-section">
                    <h4 style="color: #667eea; margin-bottom: 10px;">üòå Nivel de Relajaci√≥n</h4>
                    <p style="font-size: 0.85em; color: #a0aec0; margin-bottom: 10px;">
                        ¬øQu√© tan relajado/a te sientes comparado con antes?
                    </p>
                    <div class="rating-scale" data-metric="relaxation">
                        <button class="rating-btn" data-value="1" onclick="setRating('relaxation', 1)">1</button>
                        <button class="rating-btn" data-value="2" onclick="setRating('relaxation', 2)">2</button>
                        <button class="rating-btn" data-value="3" onclick="setRating('relaxation', 3)">3</button>
                        <button class="rating-btn" data-value="4" onclick="setRating('relaxation', 4)">4</button>
                        <button class="rating-btn" data-value="5" onclick="setRating('relaxation', 5)">5</button>
                    </div>
                    <div style="font-size: 0.8em; color: #718096; display: flex; justify-content: space-between;">
                        <span>Menos</span><span>Igual</span><span>M√°s</span>
                    </div>
                </div>

                <div class="eval-section">
                    <h4 style="color: #667eea; margin-bottom: 10px;">üéØ Claridad Mental</h4>
                    <p style="font-size: 0.85em; color: #a0aec0; margin-bottom: 10px;">
                        ¬øC√≥mo est√° tu claridad mental ahora vs. antes?
                    </p>
                    <div class="rating-scale" data-metric="focus">
                        <button class="rating-btn" data-value="1" onclick="setRating('focus', 1)">1</button>
                        <button class="rating-btn" data-value="2" onclick="setRating('focus', 2)">2</button>
                        <button class="rating-btn" data-value="3" onclick="setRating('focus', 3)">3</button>
                        <button class="rating-btn" data-value="4" onclick="setRating('focus', 4)">4</button>
                        <button class="rating-btn" data-value="5" onclick="setRating('focus', 5)">5</button>
                    </div>
                    <div style="font-size: 0.8em; color: #718096; display: flex; justify-content: space-between;">
                        <span>Peor</span><span>Igual</span><span>Mejor</span>
                    </div>
                </div>

                <div class="eval-section">
                    <h4 style="color: #667eea; margin-bottom: 10px;">üòä Estado de √Ånimo</h4>
                    <p style="font-size: 0.85em; color: #a0aec0; margin-bottom: 10px;">
                        ¬øC√≥mo cambi√≥ tu estado de √°nimo?
                    </p>
                    <div class="rating-scale" data-metric="mood">
                        <button class="rating-btn" data-value="1" onclick="setRating('mood', 1)">1</button>
                        <button class="rating-btn" data-value="2" onclick="setRating('mood', 2)">2</button>
                        <button class="rating-btn" data-value="3" onclick="setRating('mood', 3)">3</button>
                        <button class="rating-btn" data-value="4" onclick="setRating('mood', 4)">4</button>
                        <button class="rating-btn" data-value="5" onclick="setRating('mood', 5)">5</button>
                    </div>
                    <div style="font-size: 0.8em; color: #718096; display: flex; justify-content: space-between;">
                        <span>Peor</span><span>Igual</span><span>Mejor</span>
                    </div>
                </div>

                <div class="eval-section">
                    <h4 style="color: #667eea; margin-bottom: 10px;">‚ö° Energ√≠a</h4>
                    <p style="font-size: 0.85em; color: #a0aec0; margin-bottom: 10px;">
                        ¬øC√≥mo est√°n tus niveles de energ√≠a?
                    </p>
                    <div class="rating-scale" data-metric="energy">
                        <button class="rating-btn" data-value="1" onclick="setRating('energy', 1)">1</button>
                        <button class="rating-btn" data-value="2" onclick="setRating('energy', 2)">2</button>
                        <button class="rating-btn" data-value="3" onclick="setRating('energy', 3)">3</button>
                        <button class="rating-btn" data-value="4" onclick="setRating('energy', 4)">4</button>
                        <button class="rating-btn" data-value="5" onclick="setRating('energy', 5)">5</button>
                    </div>
                    <div style="font-size: 0.8em; color: #718096; display: flex; justify-content: space-between;">
                        <span>M√°s cansado</span><span>Igual</span><span>M√°s energizado</span>
                    </div>
                </div>

                <div class="eval-section" style="grid-column: 1 / -1;">
                    <h4 style="color: #667eea; margin-bottom: 10px;">üí¨ Comentarios</h4>
                    <textarea id="sessionComments" placeholder="Describe cualquier efecto, sensaci√≥n o observaci√≥n espec√≠fica..."
                             style="width: 100%; height: 80px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); 
                                    border-radius: 8px; padding: 10px; color: #e2e8f0; resize: vertical;"></textarea>
                    
                    <button class="btn btn-primary" onclick="saveEvaluation()" style="margin-top: 10px;">
                        üíæ Guardar Evaluaci√≥n
                    </button>
                </div>
            </div>
        </div>

        <!-- INFORMACI√ìN CIENT√çFICA -->
        <div class="scientific-info">
            <h3 style="color: #68d391; margin-bottom: 15px; font-size: 1.4em;">üî¨ Fundamentos Cient√≠ficos</h3>
            
            <div class="research-grid">
                <div class="research-card">
                    <h4 style="color: #48bb78; margin-bottom: 10px;">üéØ Diferencias vs Brain.fm</h4>
                    <ul style="color: #9ae6b4; line-height: 1.6; margin-left: 20px;">
                        <li><strong>Transparencia:</strong> Par√°metros completamente abiertos</li>
                        <li><strong>Claims honestos:</strong> Sin promesas exageradas</li>
                        <li><strong>Auto-evaluaci√≥n:</strong> Tracking de efectos reales</li>
                        <li><strong>C√≥digo abierto:</strong> Algoritmos verificables</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ==========================================
        // BEYOND BRAIN.FM - SISTEMA CIENT√çFICO HONESTO
        // ==========================================

        class BeyondBrainFMSystem {
            constructor() {
                this.audioContext = null;
                this.currentSource = null;
                this.gainNode = null;
                this.isPlaying = false;
                this.isPaused = false;
                this.currentState = null;
                this.duration = 15; // Default 15 minutes
                this.sessionTimer = null;
                this.visualizerTimer = null;
                this.elapsedTime = 0;
                this.totalPhases = 0;
                this.currentPhase = 0;
                this.sessionData = [];
                this.currentEvaluation = {};

                // Estados basados en literatura real
                this.states = {
                    'deep-relaxation': {
                        name: 'Deep Relaxation',
                        frequency: 10,          // Alpha 10Hz - evidencia s√≥lida
                        carrier: 220,           // A3 - frecuencia agradable
                        modulation: 0.30,       // 30% modulaci√≥n
                        fadeDuration: 60,       // 60s entrada/salida
                        evidence: 'ALTA',
                        description: 'Estado Alpha para relajaci√≥n profunda',
                        minDuration: 10,
                        maxDuration: 30,
                        icon: 'üßò'
                    },
                    'calm-focus': {
                        name: 'Calm Focus',
                        frequency: 13,          // SMR 13Hz - neurofeedback cl√≠nico
                        carrier: 220,
                        modulation: 0.25,       // 25% modulaci√≥n m√°s sutil
                        fadeDuration: 60,
                        evidence: 'ALTA',
                        description: 'SMR para atenci√≥n calmada',
                        minDuration: 15,
                        maxDuration: 35,
                        icon: '‚ö°'
                    },
                    'meditative': {
                        name: 'Meditative State',
                        frequency: 6,           // Theta 6Hz - meditaci√≥n
                        carrier: 220,
                        modulation: 0.35,       // 35% modulaci√≥n m√°s profunda
                        fadeDuration: 90,       // Transici√≥n m√°s larga para Theta
                        evidence: 'MODERADA',
                        description: 'Theta para estados meditativos',
                        minDuration: 15,
                        maxDuration: 40,
                        icon: 'üåô'
                    }
                };

                this.init();
            }

            init() {
                this.createVisualizer();
                this.loadSessionHistory();
                console.log('üß† Beyond Brain.fm System initialized');
                console.log('üî¨ Estados disponibles:', Object.keys(this.states));
            }

            createVisualizer() {
                const visualizer = document.getElementById('visualizer');
                visualizer.innerHTML = '';
                
                for (let i = 0; i < 40; i++) {
                    const bar = document.createElement('div');
                    bar.className = 'wave-bar';
                    bar.style.height = '8px';
                    visualizer.appendChild(bar);
                }
            }

            animateVisualizer() {
                if (!this.isPlaying || this.isPaused) return;

                const bars = document.querySelectorAll('.wave-bar');
                const frequency = this.currentState ? this.states[this.currentState].frequency : 1;
                
                bars.forEach((bar, index) => {
                    const time = Date.now() / 1000;
                    const offset = index * 0.1;
                    const wave = Math.sin((time + offset) * frequency * 0.5);
                    const intensity = 0.3 + (wave * 0.4);
                    const height = 8 + (intensity * 30);
                    
                    bar.style.height = `${height}px`;
                    bar.style.opacity = 0.6 + (intensity * 0.4);
                });
            }

            selectState(stateId) {
                // Reset previous selection
                document.querySelectorAll('.state-card').forEach(card => {
                    card.classList.remove('selected');
                });

                // Select new state
                document.querySelector(`[data-state="${stateId}"]`).classList.add('selected');
                
                this.currentState = stateId;
                const state = this.states[stateId];
                
                document.getElementById('currentStateName').textContent = state.name;
                document.getElementById('currentStateParams').textContent = 
                    `${state.frequency}Hz ‚Ä¢ Modulaci√≥n ${Math.round(state.modulation * 100)}%`;
                
                // Enable start button
                document.getElementById('startBtn').disabled = false;
                
                this.showAlert(`Estado seleccionado: ${state.icon} ${state.name}`, 'info', 2000);
                
                console.log(`üéØ Estado seleccionado: ${stateId}`, state);
            }

            selectDuration(minutes) {
                document.querySelectorAll('.duration-btn').forEach(btn => {
                    btn.classList.remove('selected');
                });
                
                document.querySelector(`[data-duration="${minutes}"]`).classList.add('selected');
                this.duration = minutes;
                
                console.log(`‚è∞ Duraci√≥n seleccionada: ${minutes} minutos`);
            }

            async initAudio() {
                try {
                    this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    
                    if (this.audioContext.state === 'suspended') {
                        await this.audioContext.resume();
                    }
                    
                    this.gainNode = this.audioContext.createGain();
                    this.gainNode.connect(this.audioContext.destination);
                    this.gainNode.gain.value = 0.4; // Volume moderado
                    
                    console.log('üîä Audio context inicializado:', this.audioContext.state);
                    return true;
                } catch (error) {
                    console.error('‚ùå Error inicializando audio:', error);
                    return false;
                }
            }

            generateIsochronicTone(state, duration) {
                const sampleRate = this.audioContext.sampleRate;
                const samples = Math.floor(duration * sampleRate);
                const buffer = this.audioContext.createBuffer(2, samples, sampleRate);
                
                const leftChannel = buffer.getChannelData(0);
                const rightChannel = buffer.getChannelData(1);
                
                const params = this.states[state];
                const fadeInSamples = params.fadeDuration * sampleRate;
                const fadeOutSamples = params.fadeDuration * sampleRate;
                const stableSamples = samples - fadeInSamples - fadeOutSamples;
                
                console.log(`üéµ Generando tono isochronic:`, {
                    frequency: params.frequency,
                    carrier: params.carrier,
                    modulation: params.modulation,
                    duration: duration,
                    samples: samples
                });
                
                for (let i = 0; i < samples; i++) {
                    const time = i / sampleRate;
                    
                    // Envelope de volumen con fade in/out
                    let volumeEnvelope = 1.0;
                    if (i < fadeInSamples) {
                        volumeEnvelope = i / fadeInSamples;
                    } else if (i > samples - fadeOutSamples) {
                        volumeEnvelope = (samples - i) / fadeOutSamples;
                    }
                    
                    // Aplicar curva suave al envelope
                    volumeEnvelope = volumeEnvelope * volumeEnvelope * (3 - 2 * volumeEnvelope);
                    
                    // Carrier wave (tono base)
                    const carrierWave = Math.sin(2 * Math.PI * params.carrier * time);
                    
                    // Modulaci√≥n isochronic
                    const modulationWave = (1 + Math.sin(2 * Math.PI * params.frequency * time)) / 2;
                    
                    // Combinar carrier + modulaci√≥n
                    const modulatedWave = carrierWave * (1 - params.modulation + params.modulation * modulationWave);
                    
                    // Aplicar envelope de volumen
                    const finalSample = modulatedWave * volumeEnvelope * 0.3; // Volume global bajo
                    
                    leftChannel[i] = finalSample;
                    rightChannel[i] = finalSample;
                }
                
                return buffer;
            }

            async startSession() {
                if (!this.currentState) {
                    this.showAlert('‚ö†Ô∏è Selecciona un estado primero', 'warning');
                    return;
                }

                const state = this.states[this.currentState];
                
                const confirmed = confirm(`üß† BEYOND BRAIN.FM - CONFIRMACI√ìN DE SESI√ìN

üéØ Estado: ${state.icon} ${state.name}
‚è∞ Duraci√≥n: ${this.duration} minutos
üéµ Frecuencia: ${state.frequency}Hz (${state.evidence} evidencia)
üîä Modulaci√≥n: ${Math.round(state.modulation * 100)}%

‚ö†Ô∏è RECORDATORIOS IMPORTANTES:
‚Ä¢ Los efectos son sutiles y variables entre personas
‚Ä¢ Esta sesi√≥n es para uso personal/experimental
‚Ä¢ No reemplaza tratamientos m√©dicos profesionales
‚Ä¢ Eval√∫a honestamente tus efectos post-sesi√≥n

üéß Recomendaci√≥n: Auriculares, volumen c√≥modo, ambiente tranquilo.

¬øConfirmas iniciar la sesi√≥n?`);

                if (!confirmed) return;

                try {
                    const audioReady = await this.initAudio();
                    if (!audioReady) {
                        this.showAlert('‚ùå Error: No se pudo inicializar el audio', 'warning');
                        return;
                    }

                    // Inicializar sesi√≥n
                    this.isPlaying = true;
                    this.isPaused = false;
                    this.elapsedTime = 0;
                    this.currentPhase = 0;
                    this.totalPhases = 3; // Fade-in, stable, fade-out

                    // UI updates
                    document.getElementById('startBtn').disabled = true;
                    document.getElementById('pauseBtn').disabled = false;
                    document.getElementById('stopBtn').disabled = false;
                    document.getElementById('sessionInfo').classList.remove('hidden');

                    // Start timers
                    this.startSessionTimer();
                    this.visualizerTimer = setInterval(() => this.animateVisualizer(), 100);

                    // Generate and play audio
                    const buffer = this.generateIsochronicTone(this.currentState, this.duration * 60);
                    
                    this.currentSource = this.audioContext.createBufferSource();
                    this.currentSource.buffer = buffer;
                    this.currentSource.connect(this.gainNode);
                    
                    this.currentSource.onended = () => {
                        if (this.isPlaying) {
                            this.completeSession();
                        }
                    };
                    
                    this.currentSource.start();
                    
                    this.showAlert(`üéµ Sesi√≥n iniciada: ${state.name}`, 'success', 3000);
                    
                    console.log(`üöÄ Sesi√≥n iniciada:`, {
                        state: this.currentState,
                        duration: this.duration,
                        frequency: state.frequency
                    });

                } catch (error) {
                    console.error('‚ùå Error iniciando sesi√≥n:', error);
                    this.showAlert(`Error: ${error.message}`, 'warning');
                    this.stopSession();
                }
            }

            togglePause() {
                if (!this.isPlaying) return;

                if (this.isPaused) {
                    this.isPaused = false;
                    document.getElementById('pauseBtn').textContent = '‚è∏Ô∏è Pausar';
                    this.showAlert('‚ñ∂Ô∏è Sesi√≥n reanudada', 'info', 2000);
                } else {
                    this.isPaused = true;
                    if (this.currentSource) {
                        this.currentSource.stop();
                    }
                    document.getElementById('pauseBtn').textContent = '‚ñ∂Ô∏è Reanudar';
                    this.showAlert('‚è∏Ô∏è Sesi√≥n pausada', 'info', 2000);
                }
            }

            stopSession() {
                this.isPlaying = false;
                this.isPaused = false;

                // Stop audio
                if (this.currentSource) {
                    try {
                        this.currentSource.stop();
                        this.currentSource.disconnect();
                    } catch (e) {
                        // Already stopped
                    }
                    this.currentSource = null;
                }

                // Stop timers
                if (this.sessionTimer) {
                    clearInterval(this.sessionTimer);
                    this.sessionTimer = null;
                }
                if (this.visualizerTimer) {
                    clearInterval(this.visualizerTimer);
                    this.visualizerTimer = null;
                }

                // Reset UI
                document.getElementById('startBtn').disabled = this.currentState ? false : true;
                document.getElementById('pauseBtn').disabled = true;
                document.getElementById('stopBtn').disabled = true;
                document.getElementById('pauseBtn').textContent = '‚è∏Ô∏è Pausar';
                document.getElementById('sessionInfo').classList.add('hidden');
                document.getElementById('timerDisplay').textContent = '00:00';
                document.getElementById('progressFill').style.width = '0%';
                document.getElementById('phaseDisplay').textContent = 'Preparando...';

                // Reset visualizer
                const bars = document.querySelectorAll('.wave-bar');
                bars.forEach(bar => {
                    bar.style.height = '8px';
                    bar.style.opacity = '0.6';
                });

                this.elapsedTime = 0;
                this.currentPhase = 0;

                this.showAlert('‚èπÔ∏è Sesi√≥n detenida', 'info', 2000);
                console.log('‚èπÔ∏è Sesi√≥n detenida');
            }

            startSessionTimer() {
                const totalSeconds = this.duration * 60;
                
                this.sessionTimer = setInterval(() => {
                    if (!this.isPaused && this.isPlaying) {
                        this.elapsedTime++;
                        
                        const minutes = Math.floor(this.elapsedTime / 60);
                        const seconds = this.elapsedTime % 60;
                        
                        document.getElementById('timerDisplay').textContent = 
                            `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                        
                        const progress = (this.elapsedTime / totalSeconds) * 100;
                        document.getElementById('progressFill').style.width = `${Math.min(progress, 100)}%`;
                        
                        // Update phase display
                        const state = this.states[this.currentState];
                        const fadeTime = state.fadeDuration;
                        const stableTime = totalSeconds - (2 * fadeTime);
                        
                        if (this.elapsedTime < fadeTime) {
                            document.getElementById('phaseDisplay').textContent = 'üîÑ Entrada gradual...';
                        } else if (this.elapsedTime < fadeTime + stableTime) {
                            document.getElementById('phaseDisplay').textContent = `üéµ ${state.name} ${state.frequency}Hz`;
                        } else {
                            document.getElementById('phaseDisplay').textContent = 'üîÑ Salida suave...';
                        }
                    }
                }, 1000);
            }

            completeSession() {
                console.log('‚úÖ Sesi√≥n completada exitosamente');
                
                // Guardar datos de sesi√≥n
                const sessionRecord = {
                    timestamp: new Date().toISOString(),
                    state: this.currentState,
                    stateName: this.states[this.currentState].name,
                    frequency: this.states[this.currentState].frequency,
                    duration: this.duration,
                    completed: true
                };
                
                this.sessionData.push(sessionRecord);
                this.saveSessionHistory();
                
                this.stopSession();
                
                this.showAlert(`üéâ ¬°Sesi√≥n completada! ${this.duration} minutos de ${this.states[this.currentState].name}`, 'success', 5000);
                
                // Mostrar panel de evaluaci√≥n
                document.getElementById('evaluationGrid').style.display = 'grid';
                document.querySelector('.evaluation-panel').scrollIntoView({ behavior: 'smooth' });
                
                // Reset evaluation
                this.currentEvaluation = {
                    sessionId: sessionRecord.timestamp,
                    state: this.currentState,
                    duration: this.duration
                };
            }

            setRating(metric, value) {
                // Visual update
                const ratingScale = document.querySelector(`[data-metric="${metric}"]`);
                ratingScale.querySelectorAll('.rating-btn').forEach(btn => {
                    btn.classList.remove('selected');
                });
                ratingScale.querySelector(`[data-value="${value}"]`).classList.add('selected');
                
                // Save rating
                this.currentEvaluation[metric] = value;
                
                console.log(`üìä Rating ${metric}: ${value}`);
            }

            saveEvaluation() {
                const comments = document.getElementById('sessionComments').value.trim();
                
                // Verificar que al menos una rating est√© completa
                const requiredMetrics = ['relaxation', 'focus', 'mood', 'energy'];
                const completedMetrics = requiredMetrics.filter(metric => 
                    this.currentEvaluation.hasOwnProperty(metric)
                );
                
                if (completedMetrics.length === 0) {
                    this.showAlert('‚ö†Ô∏è Completa al menos una evaluaci√≥n antes de guardar', 'warning');
                    return;
                }
                
                // A√±adir comentarios y timestamp
                this.currentEvaluation.comments = comments;
                this.currentEvaluation.evaluatedAt = new Date().toISOString();
                this.currentEvaluation.metricsCompleted = completedMetrics.length;
                
                // Guardar evaluaci√≥n
                const evaluations = JSON.parse(localStorage.getItem('beyondbrainfm_evaluations') || '[]');
                evaluations.push(this.currentEvaluation);
                localStorage.setItem('beyondbrainfm_evaluations', JSON.stringify(evaluations));
                
                this.showAlert(`üíæ Evaluaci√≥n guardada (${completedMetrics.length}/4 m√©tricas)`, 'success', 3000);
                
                // Ocultar panel de evaluaci√≥n
                document.getElementById('evaluationGrid').style.display = 'none';
                
                // Reset form
                document.querySelectorAll('.rating-btn').forEach(btn => btn.classList.remove('selected'));
                document.getElementById('sessionComments').value = '';
                
                console.log('üíæ Evaluaci√≥n guardada:', this.currentEvaluation);
                
                // Reset evaluation object
                this.currentEvaluation = {};
            }

            saveSessionHistory() {
                localStorage.setItem('beyondbrainfm_sessions', JSON.stringify(this.sessionData));
            }

            loadSessionHistory() {
                const saved = localStorage.getItem('beyondbrainfm_sessions');
                if (saved) {
                    this.sessionData = JSON.parse(saved);
                    console.log(`üìö Cargadas ${this.sessionData.length} sesiones anteriores`);
                }
            }

            showAlert(message, type = 'info', duration = 4000) {
                const alert = document.createElement('div');
                alert.className = `alert alert-${type}`;
                alert.innerHTML = `<strong>${message}</strong>`;
                
                document.body.appendChild(alert);
                
                setTimeout(() => {
                    if (document.body.contains(alert)) {
                        alert.style.animation = 'slideOut 0.5s ease';
                        setTimeout(() => {
                            if (document.body.contains(alert)) {
                                document.body.removeChild(alert);
                            }
                        }, 500);
                    }
                }, duration);
            }
        }

        // Global instance and functions
        let beyondBrainFM;

        function selectState(stateId) {
            beyondBrainFM.selectState(stateId);
        }

        function selectDuration(minutes) {
            beyondBrainFM.selectDuration(minutes);
        }

        function startSession() {
            beyondBrainFM.startSession();
        }

        function togglePause() {
            beyondBrainFM.togglePause();
        }

        function stopSession() {
            beyondBrainFM.stopSession();
        }

        function setRating(metric, value) {
            beyondBrainFM.setRating(metric, value);
        }

        function saveEvaluation() {
            beyondBrainFM.saveEvaluation();
        }

        // Initialize system
        document.addEventListener('DOMContentLoaded', function() {
            beyondBrainFM = new BeyondBrainFMSystem();
            console.log('üß† Beyond Brain.fm System loaded successfully');
        });

        // Debug access
        window.getBeyondBrainFM = () => beyondBrainFM;
    </script>

    <!-- FOOTER -->
    <div style="text-align: center; margin: 40px 0; padding: 30px; background: rgba(255,255,255,0.05); border-radius: 15px;">
        <h3 style="color: #667eea; margin-bottom: 15px;">üèÜ BEYOND BRAIN.FM - SISTEMA CIENT√çFICAMENTE HONESTO</h3>
        <p style="color: #b794f6; line-height: 1.6; margin-bottom: 20px;">
            Sistema superior a Brain.fm con transparencia total y honestidad cient√≠fica<br>
            Sin marketing exagerado ‚Ä¢ Par√°metros abiertos ‚Ä¢ Auto-evaluaci√≥n real<br>
            <strong>‚úÖ Evidencia verificable ‚Ä¢ üî¨ Claims honestos ‚Ä¢ üìä Tracking subjetivo</strong>
        </p>
        
        <div style="background: rgba(102, 126, 234, 0.1); border: 2px solid #667eea; padding: 20px; border-radius: 15px; margin: 20px 0;">
            <h4 style="color: #667eea; margin-bottom: 15px;">üéØ DIFERENCIAS CLAVE VS BRAIN.FM</h4>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                <div>
                    <strong style="color: #68d391;">‚úÖ Nuestro Approach:</strong>
                    <ul style="text-align: left; margin: 8px 0 0 20px; line-height: 1.6;">
                        <li>Par√°metros completamente abiertos</li>
                        <li>Claims verificables y honestos</li>
                        <li>Auto-evaluaci√≥n de efectos reales</li>
                        <li>Referencias cient√≠ficas espec√≠ficas</li>
                    </ul>
                </div>
                <div>
                    <strong style="color: #fed7d7;">‚ùå Problemas de Brain.fm:</strong>
                    <ul style="text-align: left; margin: 8px 0 0 20px; line-height: 1.6;">
                        <li>Algoritmos propietarios no verificables</li>
                        <li>Marketing exagerado sobre efectos</li>
                        <li>Estudios limitados y sesgados</li>
                        <li>Claims no replicados independientemente</li>
                    </ul>
                </div>
            </div>
        </div>
        
        <p style="color: #a0aec0; font-size: 0.9em; margin-top: 20px;">
            <strong>Uso responsable:</strong> Este sistema es para exploraci√≥n personal y no constituye tratamiento m√©dico.
            Los efectos de audio neurol√≥gico son sutiles y variables. Eval√∫a honestamente tu experiencia individual.
        </p>
    </div>

    <script>
    // ==========================================
    // PWA INSTALLATION & SERVICE WORKER
    // ==========================================
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', async () => {
            try {
                const registration = await navigator.serviceWorker.register('./service-worker.js', {
                    scope: './'
                });
                console.log('‚úÖ Service Worker registrado:', registration.scope);
                
                // Manejar actualizaciones
                registration.addEventListener('updatefound', () => {
                    const newWorker = registration.installing;
                    newWorker.addEventListener('statechange', () => {
                        if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                            // Nueva versi√≥n disponible
                            showUpdateNotification();
                        }
                    });
                });
            } catch (error) {
                console.error('‚ùå Error registrando Service Worker:', error);
            }
        });
    }

    // PWA Install Prompt
    let deferredPrompt;

    window.addEventListener('beforeinstallprompt', (e) => {
        console.log('üíæ PWA instalable detectada');
        e.preventDefault();
        deferredPrompt = e;
        showInstallButton();
    });

    function showInstallButton() {
        // Crear bot√≥n de instalaci√≥n si no existe
        if (!document.getElementById('pwa-install-btn')) {
            const installBtn = document.createElement('button');
            installBtn.id = 'pwa-install-btn';
            installBtn.innerHTML = 'üì± Instalar App';
            installBtn.style.cssText = `
                position: fixed;
                bottom: 20px;
                right: 20px;
                background: linear-gradient(45deg, #667eea, #764ba2);
                color: white;
                border: none;
                padding: 12px 20px;
                border-radius: 25px;
                cursor: pointer;
                font-weight: bold;
                box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
                z-index: 1000;
                transition: transform 0.2s ease;
            `;
            
            installBtn.addEventListener('click', async () => {
                if (deferredPrompt) {
                    deferredPrompt.prompt();
                    const result = await deferredPrompt.userChoice;
                    console.log('üë§ Usuario eligi√≥:', result.outcome);
                    deferredPrompt = null;
                    installBtn.remove();
                }
            });
            
            installBtn.addEventListener('mouseenter', () => {
                installBtn.style.transform = 'scale(1.05)';
            });
            
            installBtn.addEventListener('mouseleave', () => {
                installBtn.style.transform = 'scale(1)';
            });
            
            document.body.appendChild(installBtn);
        }
    }

    function showUpdateNotification() {
        const updateDiv = document.createElement('div');
        updateDiv.innerHTML = `
            <div style="position: fixed; top: 20px; right: 20px; background: #667eea; color: white; 
                        padding: 15px; border-radius: 10px; z-index: 1001; max-width: 300px;">
                <strong>üîÑ Nueva versi√≥n disponible</strong>
                <p style="margin: 5px 0;">Actualiza para obtener las mejoras m√°s recientes.</p>
                <button onclick="updateApp()" style="background: white; color: #667eea; border: none; 
                        padding: 8px 16px; border-radius: 5px; cursor: pointer; margin-right: 10px;">
                    Actualizar
                </button>
                <button onclick="this.parentElement.parentElement.remove()" style="background: transparent; 
                        color: white; border: 1px solid white; padding: 8px 16px; border-radius: 5px; cursor: pointer;">
                    Despu√©s
                </button>
            </div>
        `;
        document.body.appendChild(updateDiv);
    }

    function updateApp() {
        if (navigator.serviceWorker.controller) {
            navigator.serviceWorker.controller.postMessage({type: 'SKIP_WAITING'});
            window.location.reload();
        }
    }
    </script>
</body>
</html>bottom: 10px;">üìä Par√°metros Usados</h4>
                    <ul style="color: #9ae6b4; line-height: 1.6; margin-left: 20px;">
                        <li><strong>Isochronic Tones:</strong> Modulaci√≥n de amplitud pura</li>
                        <li><strong>Carrier 220Hz:</strong> Frecuencia A3, naturalmente agradable</li>
                        <li><strong>Modulaci√≥n:</strong> 25-35% seg√∫n estado</li>
                        <li><strong>Entrada/Salida:</strong> 60s fade suave</li>
                    </ul>
                </div>
                
                <div class="research-card">
                    <h4 style="color: #48bb78; margin-bottom: 10px;">üìö Referencias</h4>
                    <ul style="color: #9ae6b4; line-height: 1.6; margin-left: 20px; font-size: 0.9em;">
                        <li>Alpha: Clayton et al. (2015) - EEG en relajaci√≥n</li>
                        <li>SMR: Sterman & Egner (2006) - Neurofeedback</li>
                        <li>Theta: Oster (1973) - Binaural beats</li>
                        <li>Isochronic: Richardson et al. (2011)</li>
                    </ul>
                </div>
                
                <div class="research-card">
                    <h4 style="color: #48bb78; margin-bottom: 10px;">‚ö†Ô∏è Limitaciones</h4>
                    <ul style="color: #fed7d7; line-height: 1.6; margin-left: 20px;">
                        <li>Efectos altamente variables entre personas</li>
                        <li>Mecanismos neurol√≥gicos a√∫n debatidos</li>
                        <li>Estudios a menudo con muestras peque√±as</li>
                        <li>Placebo effect significativo en algunos casos</li>
                    </ul>
                </div>
                
                <div class="research-card">
                    <h4 style="color: #48bb78; margin-